#!/usr/bin/python3

from argparse  import ArgumentParser
from wsjtx_srv import Worked_Before, get_defaults

defaults = get_defaults ()
cmd = ArgumentParser ()
cmd.add_argument \
    ( 'callsign'
    , help    = 'Callsign(s) to look up'
    , nargs   = '+'
    )
cmd.add_argument \
    ( '-a', '--adif'
    , help    = 'ADIF file to parse, default=%(default)s'
    , default = defaults ['adif_path']
    )
cmd.add_argument \
    ( '-b', '--band'
    , help    = 'Band to do lookup for, default=%(default)s'
    , default = '40m'
    )
cmd.add_argument \
    ( '-d', '--use-dxcc'
    , help    = 'If specified, use dxcc list for call lookup'
    , action  = 'store_true'
    )
cmd.add_argument \
    ( '-e', '--encoding'
    , help    = 'Encoding for ADIF file to parse, default=%(default)s'
    , default = 'utf-8'
    )
args = cmd.parse_args ()

wbf = Worked_Before (args.adif, args)
for callsign in args.callsign :
    print (callsign, end = ': ')
    entities = wbf.fuzzy_match_dxcc (callsign, use_dxcc = args.use_dxcc)
    if entities :
        print \
            ( "Entities: %s"
            % ', '.join ('%s (%s)' % (e.name, e.code) for e in entities)
            )
    else :
        print ("No DXCC Entities found for this call")
    print ('     WBF-Status: %s' % wbf.lookup_verbose (args.band, callsign))
